@model AutoMate_app.Models.UserProfile

@{
    ViewData["Title"] = "Profile Details";
    var completion = GetCompletionPercent(Model);
}

<style>
    body { background-color: #101010; color: #f9fafb; }
    .profile-card {
        background: #1c1c1c;
        border-radius: 16px;
        border: 1px solid #2a2a2a;
        color: #f9fafb;
    }
    .info-label {
        color: #e5e7eb;
        font-size: .85rem;
        text-transform: uppercase;
        letter-spacing: .05em;
    }
    .progress {
        height: 10px;
        border-radius: 5px;
        background-color: #2e2e2e;
    }
    .progress-bar {
        background: linear-gradient(90deg, #ff9966, #ff5e62);
    }
</style>

<div class="profile-card p-4 shadow-lg">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h2 class="mb-1">@Model.FullName</h2>
            <div style="color:#e5e7eb;">@Model.Email</div>
        </div>
        <div>
            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning me-2">Edit</a>
            <a asp-action="Index" class="btn btn-secondary">Back</a>
        </div>
    </div>

    <div class="mb-4">
        <div class="d-flex justify-content-between small mb-1" style="color:#e5e7eb;">
            <span>Profile Completion</span>
            <strong>@completion%</strong>
        </div>
        <div class="progress mb-2">
            <div class="progress-bar" style="width:@completion%" role="progressbar"
                 aria-valuenow="@completion" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <span class="badge @(completion == 100 ? "bg-success" : completion >= 60 ? "bg-warning text-dark" : "bg-danger")">
            @(completion == 100 ? "Complete" : completion >= 60 ? "Almost there" : "Incomplete")
        </span>
    </div>

    <div class="row gy-4">
        <div class="col-md-6">
            <div class="info-label">Full Name</div>
            <div class="fs-5">@DisplayOrPlaceholder(Model.FullName)</div>
        </div>
        <div class="col-md-6">
            <div class="info-label">Email</div>
            <div class="fs-5">@DisplayOrPlaceholder(Model.Email)</div>
        </div>
        <div class="col-md-6">
            <div class="info-label">Phone</div>
            <div class="fs-5">@DisplayOrPlaceholder(Model.PhoneNumber)</div>
        </div>
        <div class="col-md-6">
            <div class="info-label">City</div>
            <div class="fs-5">@DisplayOrPlaceholder(Model.City)</div>
        </div>
        <div class="col-12">
            <div class="info-label">Address</div>
            <div class="fs-5">@DisplayOrPlaceholder(Model.Address)</div>
        </div>
    </div>
</div>

@functions{
    private int GetCompletionPercent(AutoMate_app.Models.UserProfile profile)
    {
        var fields = new[]
        {
            profile.FullName,
            profile.Email,
            profile.PhoneNumber,
            profile.Address,
            profile.City
        };

        var filled = fields.Count(value => !string.IsNullOrWhiteSpace(value));
        return (int)((double)filled / fields.Length * 100);
    }

    private object DisplayOrPlaceholder(string? value) =>
        string.IsNullOrWhiteSpace(value)
            ? Html.Raw("<span style='color:#9ca3af;'>Not provided</span>")
            : value;
}
